<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>HANGMAN</title>
    <link href="style.css" type="text/css" rel="stylesheet">
    <script src="https://www.gstatic.com/firebasejs/5.9.2/firebase.js"></script>
    <script src="firebase.js"></script>
</head>
<body>
    <div id="container1">
        <h1 id="title">Hangman</h1>
    </div>

    <div id="container2">
        <h2 id="lives"></h2>
    </div>

    <div id="container3">
        <img class="heart" src="images/heart.png">
        <img class="heart" src="images/heart.png">
        <img class="heart" src="images/heart.png">
        <img class="heart" src="images/heart.png">
        <img class="heart" src="images/heart.png">
        <img class="heart" src="images/heart.png">
        <img class="heart" src="images/heart.png">
    </div>

    <div id="container4">
        <h2 id="answer"></h2>
    </div>


    <a id="gameover" href="#popup_gameover"></a>
    <div id="popup_gameover" class="overlay">
        <div class="popup">
            <h2>GAME OVER</h2>
            <a class="close" href="#">&times;</a>
            <center>
                <a href="#" class="play_btn">PLAY AGAIN</a>
            </center>
        </div>
    </div>
    <a id="win" href="#popup_win"></a>
    <div id="popup_win" class="overlay">
        <div class="popup">
            <h2>YOU GOT IT !</h2>
            <a class="close" href="#">&times;</a>
            <center>
                <a href="#" class="play_btn" >PLAY AGAIN</a>
            </center>
        </div>
    </div>
    <div id="container5">
        <button id="resetButton" type="button" onclick="reset()">RESTART</button>
    </div>
    <script>
        let answer_letters = "IRISBABO";        
        let blanks = "";
        let live = 7;      

        let lives = document.getElementById('lives')
        let answer = document.getElementById('answer')

        String.prototype.replaceAt=function(index, replacement) {
            return this.substr(0, index) + replacement+ this.substr(index + replacement.length);
        }

        function makeUnderScore(){
            for (let blank = 0; blank < answer_letters.length; blank++) {
                blanks += '_';
            }
            return blanks
        }        

        function makeButtons() {
            for (let i = 65; i < 90; i++) {
                let btn = document.createElement("button");
                document.body.appendChild(btn);
                btn.innerHTML = String.fromCharCode(i);
                btn.id = String.fromCharCode(i);
                btn.addEventListener("click", function () {
                    // console.log("Button " + String.fromCharCode(i) + " was clicked.")
                    let clicked_letter = String.fromCharCode(i);
                    if (isCorrectLetter(clicked_letter) == true){
                        correctLetter(clicked_letter);
                        if (blanks.indexOf('_') == -1 && live > 0) {
                            // console.log("hi");
                            document.getElementById('win').click();
                        }
                    } else {
                        wrongLetter(clicked_letter)
                    }                    
                })
            }
        }

        function initiateGame(){
            makeUnderScore();
            makeButtons();
            lives.innerHTML = "Lives: " + live;
            answer.innerHTML = showLetters(makeUnderScore); 
        }
        initiateGame();

        function isCorrectLetter(clicked_letter){
            for (let letter = 0; letter < answer_letters.length; letter++){
                if (answer_letters.includes(clicked_letter)) {
                    return true
                } else {
                    return false
                }
            }
        }

        function correctLetter(clicked_letter){
            document.getElementById(clicked_letter).disabled = true;         // disabled the button clicked
            
            for (let letter = 0; letter < answer_letters.length; letter++){   
                if (clicked_letter == answer_letters[letter]) {  
                    blanks = blanks.replaceAt(letter, clicked_letter);       // Replace '_' to the correct letter                    
                } 
            }
            document.getElementById('answer').innerHTML = showLetters(blanks);
        }

        function wrongLetter(clicked_letter){
            document.getElementById(clicked_letter).disabled = true;
            live -= 1;
            document.getElementById('lives').innerHTML = "Lives: " + live;            
            if (live == 0) {
                document.getElementById('gameover').click();
            }
        }

        function showLetters(letters){
            clean = ''
            for (let i = 0; i < blanks.length; i++) {
                clean += blanks[i] + ' ';
            }
            return clean
        }

        function reset(){
            location.reload();
        }

    </script>
</body>
</html>