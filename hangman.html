<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>HANGMAN</title>
    <link href="style.css" type="text/css" rel="stylesheet">
    <script src="https://www.gstatic.com/firebasejs/5.9.2/firebase.js"></script>
    <script src="firebase.js"></script>
</head>
<body>
    <div id="div_title">
        <h1 id="title">Hangman</h1>
    </div>

    <div id="div_lives">
        <h2 id="lives"></h2>
    </div>

    <div id="div_score">
        <h2 id="score"></h2>
    </div>

    <div id="div_hearts">
        <img id="0" class="heart" src="images/heart.png">
        <img id="1" class="heart" src="images/heart.png">
        <img id="2" class="heart" src="images/heart.png">
        <img id="3" class="heart" src="images/heart.png">
        <img id="4" class="heart" src="images/heart.png">
        <img id="5" class="heart" src="images/heart.png">
        <img id="6" class="heart" src="images/heart.png">
    </div>

    <div id="div_answer">
        <h2 id="answer"></h2>
    </div>

    <div id="buttonSpace"></div>

    <a id="gameover" href="#popup_gameover"></a>
    <div id="popup_gameover" class="overlay">
        <div class="popup">
            <h2>GAME OVER</h2>
            <a class="close" href="#">&times;</a>
            <center>
                <a href="#" onclick="softReset()" class="play_btn">PLAY AGAIN</a>
            </center>
        </div>
    </div>
    <a id="win" href="#popup_win"></a>
    <div id="popup_win" class="overlay">
        <div class="popup">
            <h2>YOU GOT IT !</h2>
            <a class="close" href="#">&times;</a>
            <center>
                <a href="#" onclick="softReset()" class="play_btn">PLAY AGAIN</a>
            </center>
        </div>
    </div>
    
    <script>
        let dbref = firebase.database().ref().child("Answers");
        let randomNumber = Math.floor(Math.random() * 3)+1;
        let dbanswer = ""; 
        let dbquestion = "";
        dbref.on("value", function(data) {
             let answerDatabase = data.val();
             let number = randomNumber;
             let fbanswer = answerDatabase[number]["Answer"]
             let fbquestion = answerDatabase[number]["Question"]
             dbanswer = fbanswer
             dbquestion = fbquestion
            
        });
        
        let answer_letters
        setTimeout(function(){ answer_letters = dbanswer; }, 500);      
        let blanks = "";
        let live = 7;    
        let score = 0;  

        let lives = document.getElementById('lives')
        let answer = document.getElementById('answer')
        let scores = document.getElementById('score')

        String.prototype.replaceAt=function(index, replacement) {
            return this.substr(0, index) + replacement+ this.substr(index + replacement.length);
        }

        function makeUnderScore(){
            for (let blank = 0; blank < answer_letters.length; blank++) {
                blanks += '_';
            }
            return blanks
        }        

        function makeButtons() {
            for (let i = 65; i < 90; i++) {
                let btn = document.createElement("button");
                document.getElementById("buttonSpace").appendChild(btn);
                btn.innerHTML = String.fromCharCode(i);
                btn.id = String.fromCharCode(i);
                btn.addEventListener("click", function () {
                    let clicked_letter = String.fromCharCode(i);
                    if (isCorrectLetter(clicked_letter) == true){
                        correctLetter(clicked_letter);
                        if (blanks.indexOf('_') == -1 && live > 0) {
                            document.getElementById('win').click();
                        }
                    } else {
                        wrongLetter(clicked_letter)
                    }                    
                })
            }
        }

        function destroyHeart(){
            document.getElementById(live).src = "images/blackheart.png"
        }


        function initiateGame(){
            makeUnderScore();
            makeButtons();
            scores.innerHTML = "Score: " + score;
            answer.innerHTML = showLetters(makeUnderScore); 
        }
        setTimeout(function(){ initiateGame(); }, 500);

        function isCorrectLetter(clicked_letter){
            for (let letter = 0; letter < answer_letters.length; letter++){
                if (answer_letters.includes(clicked_letter)) {
                    return true
                } else {
                    return false
                }
            }
        }

        function correctLetter(clicked_letter){
            document.getElementById(clicked_letter).disabled = true;         // disabled the button clicked
            
            for (let letter = 0; letter < answer_letters.length; letter++){   
                if (clicked_letter == answer_letters[letter]) {  
                    blanks = blanks.replaceAt(letter, clicked_letter);       // Replace '_' to the correct letter       
                    score += 1;
                    scores.innerHTML = "Score:" + score;             
                } 
            }
            document.getElementById('answer').innerHTML = showLetters(blanks);
        }

        function wrongLetter(clicked_letter){
            document.getElementById(clicked_letter).disabled = true;
            live -= 1;
            destroyHeart();
            score -= -1;
            scores.innerHTML = "Score: " + score;          
            if (live == 0) {
                document.getElementById('gameover').click();
            }
        }

        function showLetters(letters){
            clean = ''
            for (let i = 0; i < blanks.length; i++) {
                clean += blanks[i] + ' ';
            }
            return clean
        }

        function softReset(){
        live = 7;
        blanks = "";
        answer_letters = "IRISCHOW";
        for (let i = 65; i < 90; i++){
            let btn = document.getElementById(String.fromCharCode(i));
            btn.disabled = false;
        }
        answer.innerHTML = showLetters(makeUnderScore())
        }

        function reset(){
            location.reload();
        }

    </script>
    <br>
    <div id="div_restart">
        <button id="resetButton" type="button" onclick="reset()">RESTART</button>
    </div>
</body>
</html>